<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–ª–µ–¥–∂–∞</title>
    <style>
        :root {
            --bg-color: #f5f5f5;
            --text-color: #333;
            --header-bg: #fff;
            --nav-bg: #fff;
            --card-bg: #fff;
            --primary-color: #0088cc;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .dark-theme {
            --bg-color: #1a1a1a;
            --text-color: #fff;
            --header-bg: #2d2d2d;
            --nav-bg: #2d2d2d;
            --card-bg: #333;
            --primary-color: #4da8da;
            --shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        /* –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è */

        .admin-panel {
            margin-top: 20px;
            padding: 15px;
            background: var(--card-bg);
            border-radius: 8px;
        }

        .admin-panel textarea {
            width: 100%;
            height: 80px;
            margin-bottom: 10px;
            padding: 8px;
            border: 1px solid var(--primary-color);
            border-radius: 5px;
            resize: vertical;
        }

        .admin-panel button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            float: right;
        }
    </style>
</head>
<body>
    <!-- –û—Å—Ç–∞–ª—å–Ω–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

    <script>
        let isAdmin = false;

        async function checkAdmin() {
            try {
                const initData = new URLSearchParams(Telegram.WebApp.initData);
                const user = JSON.parse(initData.get('user'));
                const response = await fetch('http://–í–ê–®_IP:5000/api/events', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: user.id, text: ''})
                });
                isAdmin = response.status === 200;
                if(isAdmin) showAdminPanel();
            } catch(e) {
                console.error('Admin check error:', e);
            }
        }

        function showAdminPanel() {
            const adminHTML = `
                <div class="admin-panel">
                    <textarea id="newEventText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–±—ã—Ç–∏—è"></textarea>
                    <button onclick="addNewEvent()">–î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏–µ</button>
                </div>
            `;
            document.querySelector('.events-list').insertAdjacentHTML('beforeend', adminHTML);
        }

        async function loadEvents() {
            try {
                const response = await fetch('http://–í–ê–®_IP:5000/api/events');
                const events = await response.json();
                const eventsHTML = events.map(event => `
                    <div class="event-item">
                        <p>${event.text}</p>
                        <small>${event.date}</small>
                    </div>
                `).join('');
                document.querySelector('.events-list').innerHTML = eventsHTML;
            } catch(e) {
                console.error('Error loading events:', e);
            }
        }

        async function addNewEvent() {
            const text = document.getElementById('newEventText').value;
            if(!text) return;

            try {
                const initData = new URLSearchParams(Telegram.WebApp.initData);
                const user = JSON.parse(initData.get('user'));
                await fetch('http://–í–ê–®_IP:5000/api/events', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({user_id: user.id, text: text})
                });
                document.getElementById('newEventText').value = '';
                loadEvents();
            } catch(e) {
                console.error('Error adding event:', e);
            }
        }

        window.onload = function() {
            if(localStorage.getItem('theme') === 'dark') {
                document.body.classList.add('dark-theme');
                document.querySelector('.theme-toggle').textContent = 'üåú';
            }
            
            Telegram.WebApp.ready();
            Telegram.WebApp.expand();
            
            loadEvents();
            checkAdmin();
        }
    </script>
</body>
</html>
